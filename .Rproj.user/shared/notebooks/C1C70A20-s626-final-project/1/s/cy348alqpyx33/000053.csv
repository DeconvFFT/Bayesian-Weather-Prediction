"0","n <- nrow(X)"
"0",""
"0","XtX.inv <- solve(t(X) %*% X)"
"0","H <- X %*% XtX.inv %*%t(X)"
"0","beta.ols <- XtX.inv %*%t(X)%*%weather.df$apparent_temperature"
"0","SSRg <- t(weather.df$apparent_temperature) %*% (diag(n) - g/(g+1) *H) %*% weather.df$apparent_temperature"
"0",""
"0","# collect sigma^2 and beta"
"0","for (i in 1:nSamples){"
"0","  s2 <- 1/rgamma(n=1, shape = (nu0+n)/2, rate = (nu0*sigma20 + SSRg)/2)"
"0","  beta <- mvrnorm(n=1, mu = g/(g+1)*beta.ols, Sigma=g/(g+1) * s2 * XtX.inv)"
"0","  trace$s2[i] <- s2"
"0","  trace$beta[i,] <- beta"
"0","}"
"0","signif.df <- plyr::aaply(trace$beta, 2, function(b) {"
"0","  quantile(b, c(.025, .975))"
"0","}) %>% "
"0","  as.data.frame() %>% "
"0","  dplyr::mutate(covariate = factor(c('intercept', colnames(X)[-1]), "
"0","                                   levels = c('intercept',"
"0","                                              colnames(X)[-1])))"
"0","ggplot(signif.df) + "
"0","  geom_errorbar(aes(x = covariate, ymin = `2.5%`, ymax = `97.5%`)) + "
"0","  geom_abline(slope = 0, colour = 'red') + "
"0","  labs(title = '95% CI of coefficients')"
